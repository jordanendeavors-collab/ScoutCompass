<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>SCOUT COMPASS ADVENTURE - Riparian Preserve</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1a1a2e">
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Fredoka:wght@400;600;700&family=Courier+Prime:wght@700&display=swap" rel="stylesheet">
<style>
:root{--pm:#F5E6C8;--pd:#E8D5A8;--ink:#2C1810;--red:#DC143C;--grn:#2D5016;--blu:#1A6B8A;--gold:#DAA520;--org:#E8751A;--fg:#28A745;--tan:#C4A265}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Fredoka',sans-serif;background:#1a1a2e;overflow-x:hidden;-webkit-tap-highlight-color:transparent}
.tabs{position:sticky;top:0;z-index:200;display:flex;background:#0d0d1f;border-bottom:3px solid var(--gold);box-shadow:0 4px 20px rgba(0,0,0,.6)}
.tb{flex:1;padding:7px 2px 5px;border:none;background:0 0;color:rgba(255,215,0,.3);font-family:'Bangers',cursive;font-size:clamp(.6rem,2.3vw,.82rem);letter-spacing:1px;cursor:pointer;border-bottom:3px solid transparent;text-align:center;transition:.2s}
.tb.on{color:var(--gold);border-bottom-color:var(--red);background:rgba(220,20,60,.06)}
.tb:hover{color:var(--gold)}
.tb i{display:block;font-style:normal;font-size:1.1rem;margin-bottom:1px}
.pnl{display:none}.pnl.on{display:block}
.hdr{background:linear-gradient(135deg,var(--red),#8B0000 50%,var(--ink));padding:16px;text-align:center;border-bottom:4px solid var(--gold);position:relative;overflow:hidden}
.hdr::before{content:'';position:absolute;inset:0;opacity:.07;background:repeating-linear-gradient(45deg,transparent,transparent 20px,var(--gold) 20px,var(--gold) 21px)}
.hdr h1{font-family:'Bangers',cursive;font-size:clamp(1.4rem,5vw,2.5rem);color:var(--gold);text-shadow:3px 3px 0 rgba(0,0,0,.5);letter-spacing:4px;position:relative}
.hdr .sub{color:#FFD700;font-size:clamp(.75rem,2.5vw,1rem);font-weight:600;position:relative}
.hdr .loc{color:rgba(255,215,0,.5);font-size:.7rem;margin-top:2px;position:relative}
.scb{background:linear-gradient(180deg,#1a1a2e,#16213e);padding:10px;display:flex;justify-content:space-around;flex-wrap:wrap;gap:5px;border-bottom:3px solid var(--gold)}
.sci{text-align:center}
.scl{font-size:.55rem;color:rgba(255,215,0,.4);letter-spacing:2px;font-weight:700;text-transform:uppercase}
.scv{font-family:'Courier Prime',monospace;font-size:1.4rem;color:var(--gold);font-weight:700;line-height:1.1}
.scv.g{color:var(--fg)}
.cpnl{padding:18px 12px 26px;background:radial-gradient(ellipse at 50% 40%,#1e2a4a,#0d0d1f 72%);display:flex;flex-direction:column;align-items:center;min-height:60vh}
.cst{font-family:'Courier Prime',monospace;font-size:.62rem;letter-spacing:1.5px;padding:4px 12px;border-radius:18px;margin-bottom:10px;text-align:center;transition:.3s;max-width:95%}
.cst.w{background:rgba(218,165,32,.12);color:var(--gold);border:1px solid rgba(218,165,32,.2)}
.cst.ok{background:rgba(40,167,69,.12);color:var(--fg);border:1px solid rgba(40,167,69,.2)}
.cst.no{background:rgba(140,140,140,.12);color:#aaa;border:1px solid rgba(140,140,140,.2)}
.cst.dn{background:rgba(220,20,60,.12);color:var(--red);border:1px solid rgba(220,20,60,.2)}
.actbtn{padding:10px 20px;border:2px solid var(--gold);border-radius:8px;background:linear-gradient(135deg,var(--red),#8B0000);color:var(--gold);font-family:'Bangers',cursive;font-size:1rem;letter-spacing:3px;cursor:pointer;margin:8px 0;box-shadow:0 4px 16px rgba(220,20,60,.3);display:none}
.actbtn:active{transform:scale(.96)}
.cbox{position:relative;width:min(80vw,320px);height:min(80vw,320px)}
.bzl{position:absolute;inset:0;border-radius:50%;background:conic-gradient(from 0deg,#2a1f14,#3d2e1f,#5a4530,#3d2e1f,#2a1f14);box-shadow:0 0 0 3px rgba(218,165,32,.4),0 0 30px rgba(0,0,0,.5),inset 0 0 24px rgba(0,0,0,.3);will-change:transform;transition:transform .1s ease-out}
.cface{position:absolute;inset:7px;border-radius:50%;background:radial-gradient(circle at 38% 33%,#FFF8E1,#F5E6C8 40%,#E8D5A8 80%,#D4C090);box-shadow:inset 0 2px 6px rgba(0,0,0,.1);overflow:hidden}
.cface svg{position:absolute;inset:0;width:100%;height:100%;pointer-events:none}
.clet{position:absolute;font-family:'Bangers',cursive;font-weight:900;transform:translate(-50%,-50%);pointer-events:none}
.clet.n{top:10%;left:50%;font-size:clamp(.95rem,3.6vw,1.4rem);color:var(--red)}
.clet.s{top:90%;left:50%;font-size:clamp(.8rem,2.8vw,1.1rem);color:var(--ink)}
.clet.e{top:50%;left:90%;font-size:clamp(.8rem,2.8vw,1.1rem);color:var(--ink)}
.clet.w{top:50%;left:10%;font-size:clamp(.8rem,2.8vw,1.1rem);color:var(--ink)}
.csub{position:absolute;font-family:'Fredoka',sans-serif;font-size:.55rem;font-weight:600;color:#999;transform:translate(-50%,-50%);pointer-events:none}
.ndl{position:absolute;inset:0;z-index:10;pointer-events:none}
.ndl svg{width:100%;height:100%;filter:drop-shadow(2px 3px 4px rgba(0,0,0,.3))}
.ccap{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:15px;height:15px;border-radius:50%;z-index:11;background:radial-gradient(circle at 35% 35%,#f0d080,#DAA520,#b8860b);box-shadow:0 2px 4px rgba(0,0,0,.35);border:1.5px solid #8B6914}
.tbm{position:absolute;inset:0;z-index:9;pointer-events:none;opacity:0;transition:opacity .3s}
.tbm svg{width:100%;height:100%}
.hrd{margin-top:16px;text-align:center}
.hdg{font-family:'Courier Prime',monospace;font-size:clamp(2.2rem,7.5vw,3.5rem);color:var(--gold);font-weight:700;line-height:1;text-shadow:0 0 16px rgba(218,165,32,.2)}
.hdi{font-family:'Bangers',cursive;font-size:clamp(.9rem,2.8vw,1.2rem);color:var(--red);letter-spacing:3px;margin-top:2px}
.tgt{margin-top:14px;width:100%;max-width:360px}
.tgl{font-size:.6rem;color:rgba(255,215,0,.35);letter-spacing:2px;font-weight:700;text-transform:uppercase;text-align:center;margin-bottom:4px}
.tgs{width:100%;padding:9px;border-radius:7px;border:2px solid rgba(218,165,32,.2);background:rgba(255,255,255,.04);color:var(--gold);font-family:'Fredoka',sans-serif;font-size:.8rem;cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M0 0l6 8 6-8z' fill='%23DAA520'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center}
.tgs option{background:#1a1a2e;color:#eee}
.tgi{text-align:center;margin-top:7px;font-family:'Courier Prime',monospace;font-size:.75rem;color:rgba(255,255,255,.5);min-height:20px}
.tgi .ok{color:var(--fg);font-weight:700}
/* Manual compass slider */
.manual-sec{margin-top:14px;width:100%;max-width:360px;display:none}
.manual-lab{font-size:.58rem;color:rgba(255,215,0,.3);letter-spacing:2px;font-weight:700;text-transform:uppercase;text-align:center;margin-bottom:4px}
.manual-range{width:100%;-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;background:rgba(218,165,32,.15);outline:none;cursor:pointer}
.manual-range::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;border-radius:50%;background:var(--gold);box-shadow:0 2px 6px rgba(0,0,0,.3);cursor:pointer}
.manual-range::-moz-range-thumb{width:22px;height:22px;border-radius:50%;background:var(--gold);box-shadow:0 2px 6px rgba(0,0,0,.3);cursor:pointer;border:none}
/* Debug info */
.dbg{margin-top:10px;font-family:'Courier Prime',monospace;font-size:.55rem;color:rgba(255,255,255,.2);text-align:center;max-width:360px;word-break:break-all}

/* MAP/CARDS/LEARN styles */
.rsec{background:var(--pm);padding:12px;display:flex;justify-content:center;position:relative}
.legend{background:var(--pd);padding:8px 12px;display:flex;flex-wrap:wrap;justify-content:center;gap:6px 16px;font-size:.65rem;border-top:2px solid var(--ink);border-bottom:2px solid var(--ink)}
.lgi{display:flex;align-items:center;gap:4px}
.lgs{width:12px;height:12px;border-radius:3px;border:1px solid rgba(0,0,0,.1);flex-shrink:0}
.mwrap{background:var(--pm);padding:10px}
.map{position:relative;width:100%;padding-bottom:75%;background:linear-gradient(var(--pd),var(--pm));border:3px solid var(--ink);border-radius:4px;overflow:hidden;box-shadow:inset 0 0 35px rgba(44,24,16,.1)}
.mgr{position:absolute;inset:0;z-index:1;pointer-events:none;background:linear-gradient(rgba(44,24,16,.06) 1px,transparent 1px),linear-gradient(90deg,rgba(44,24,16,.06) 1px,transparent 1px);background-size:10% 10%}
.wtr{position:absolute;border-radius:50%;background:radial-gradient(ellipse,rgba(26,107,138,.35),rgba(26,107,138,.12));border:1px solid rgba(26,107,138,.2)}
.mlb{position:absolute;font-size:.5rem;color:var(--blu);font-weight:700;letter-spacing:1px;text-transform:uppercase;opacity:.55;z-index:3;pointer-events:none}
.trl{position:absolute;inset:0;width:100%;height:100%;z-index:2;pointer-events:none}
.scbar{position:absolute;bottom:6px;left:6px;z-index:5}
.scln{width:60px;height:4px;border:1px solid var(--ink);background:repeating-linear-gradient(90deg,var(--ink) 0,var(--ink) 30px,var(--pm) 30px,var(--pm) 60px)}
.sctx{font-family:'Courier Prime',monospace;font-size:.45rem;color:var(--ink);font-weight:700;margin-top:1px}
.mk{position:absolute;z-index:10;cursor:pointer;transform:translate(-50%,-50%);transition:transform .3s cubic-bezier(.34,1.56,.64,1)}
.mk:hover{transform:translate(-50%,-50%) scale(1.25);z-index:20}
.mp{width:28px;height:28px;border-radius:50% 50% 50% 0;transform:rotate(-45deg);display:flex;align-items:center;justify-content:center;box-shadow:2px 2px 4px rgba(0,0,0,.3);border:2px solid rgba(255,255,255,.3)}
.mi{transform:rotate(45deg);font-size:12px;line-height:1}
.mn{position:absolute;top:-5px;right:-5px;width:15px;height:15px;background:var(--red);color:#fff;border-radius:50%;font-size:.5rem;font-weight:700;display:flex;align-items:center;justify-content:center;border:2px solid #fff;font-family:'Courier Prime',monospace}
.mk.fd .mp{background:var(--fg)!important;box-shadow:0 0 8px rgba(40,167,69,.4)}
.mk.fd .mn{background:var(--fg)}
.wsec{background:linear-gradient(180deg,#1a1a2e,#0f3460);padding:12px}
.stit{font-family:'Bangers',cursive;font-size:1.3rem;color:var(--gold);text-align:center;letter-spacing:3px;margin-bottom:8px;text-shadow:2px 2px 0 rgba(0,0,0,.5)}
.wgr{display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:8px;max-width:830px;margin:0 auto}
.wc{background:var(--pm);border-radius:6px;padding:9px;border-left:5px solid var(--org);box-shadow:0 2px 7px rgba(0,0,0,.2);position:relative;transition:transform .2s}
.wc:hover{transform:translateY(-2px)}
.wc.fd{border-left-color:var(--fg)}
.wc .fb{display:none;position:absolute;top:4px;right:4px;background:var(--fg);color:#fff;font-size:.55rem;font-weight:700;padding:2px 6px;border-radius:9px;font-family:'Courier Prime',monospace;letter-spacing:1px}
.wc.fd .fb{display:block}
.wh{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.wn{width:22px;height:22px;background:var(--red);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Courier Prime',monospace;font-weight:700;font-size:.7rem;flex-shrink:0}
.wnm{font-family:'Bangers',cursive;font-size:.85rem;color:var(--ink);letter-spacing:.5px}
.wsu{font-size:.65rem;color:#666}
.wcr{font-family:'Courier Prime',monospace;font-size:.6rem;color:var(--grn);background:rgba(45,80,22,.06);padding:2px 4px;border-radius:3px;display:inline-block;margin-bottom:4px}
.wd{display:grid;grid-template-columns:1fr 1fr;gap:2px 7px;font-size:.68rem;margin-bottom:4px}
.wdl{font-weight:700;color:var(--red);font-size:.55rem;text-transform:uppercase;letter-spacing:1px}
.wcl{background:rgba(218,165,32,.1);border:1px dashed var(--gold);border-radius:4px;padding:4px 6px;font-size:.7rem;font-style:italic;margin-bottom:4px}
.wt{background:rgba(45,80,22,.06);border-radius:4px;padding:4px 6px;font-size:.68rem;margin-bottom:6px}
.wb{width:100%;padding:5px;border:none;border-radius:4px;background:var(--red);color:#fff;font-family:'Bangers',cursive;font-size:.78rem;letter-spacing:2px;cursor:pointer;text-transform:uppercase;transition:background .2s}
.wb:hover{background:#B01030}
.wc.fd .wb{background:var(--fg)}
.lsec{background:var(--pd);padding:12px}
.lcard{max-width:660px;margin:0 auto;background:#fff;border-radius:8px;padding:12px;box-shadow:0 2px 10px rgba(0,0,0,.07);border:2px solid var(--grn)}
.ltit{font-family:'Bangers',cursive;font-size:1.1rem;color:var(--grn);letter-spacing:2px;margin-bottom:7px}
.ls{display:flex;gap:8px;padding:6px 0;border-bottom:1px dashed rgba(44,24,16,.08)}
.ls:last-child{border-bottom:none}
.lnm{width:22px;height:22px;background:var(--grn);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.7rem;flex-shrink:0}
.ltx{font-size:.78rem;line-height:1.4}.ltx strong{color:var(--red)}
.tsec{background:linear-gradient(135deg,#f0e6d0,#e8d5a8);padding:12px;border-top:3px solid var(--tan)}
.tgr{display:grid;grid-template-columns:repeat(auto-fill,minmax(125px,1fr));gap:6px;max-width:660px;margin:7px auto 0}
.tit2{background:#fff;border-radius:5px;padding:6px;text-align:center;border:1px solid var(--tan)}
.tic{font-size:1.1rem;margin-bottom:2px}.tnm{font-weight:700;font-size:.7rem}.tds{font-size:.55rem;color:#666;margin-top:1px}
.ftr{background:var(--ink);padding:9px;text-align:center;color:rgba(255,215,0,.3);font-size:.6rem;line-height:1.5}
.rrow{text-align:center;padding:8px;background:linear-gradient(180deg,#0f3460,#1a1a2e)}
.rbtn{padding:5px 16px;border:1px solid rgba(220,20,60,.3);border-radius:4px;background:rgba(220,20,60,.1);color:rgba(220,20,60,.6);font-family:'Courier Prime',monospace;font-size:.65rem;letter-spacing:1px;cursor:pointer}
.rbtn:hover{background:rgba(220,20,60,.2);color:var(--red)}
@media print{
*{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important}body{background:#fff!important}
.tabs,.cpnl,.actbtn,.rrow,.manual-sec,.dbg{display:none!important}.pnl{display:block!important}
.hdr{padding:8px}.scb{background:#f0f0f0!important}.scl{color:#333!important}.scv{color:var(--ink)!important}
.wsec{background:#fff!important}.stit{color:var(--ink)!important;text-shadow:none!important}
.wc{box-shadow:none;border:1px solid #ccc;break-inside:avoid}.wb,.fb{display:none!important}
.lcard{box-shadow:none}.ftr{background:#f5f5f5!important;color:#666!important}
.wsec{break-before:page}.lsec{break-before:page}
}
</style>
</head>
<body>
<nav class="tabs">
<button class="tb on" onclick="tab('c')" id="t0"><i>üß≠</i>COMPASS</button>
<button class="tb" onclick="tab('m')" id="t1"><i>üó∫Ô∏è</i>MAP</button>
<button class="tb" onclick="tab('w')" id="t2"><i>üìç</i>WAYPOINTS</button>
<button class="tb" onclick="tab('l')" id="t3"><i>üìñ</i>LEARN</button>
</nav>

<div class="pnl on" id="pc">
<div class="hdr"><h1>SCOUT COMPASS ADVENTURE</h1><div class="sub">Operation: Desert Navigator ‚Äî Riparian Preserve</div><div class="loc">2757 E Guadalupe Rd, Gilbert, AZ 85234 ¬∑ 10 Scouts ¬∑ 45 Min</div></div>
<div class="scb">
<div class="sci"><div class="scl">Waypoints</div><div class="scv">10</div></div>
<div class="sci"><div class="scl">Found</div><div class="scv g" id="fc">0</div></div>
<div class="sci"><div class="scl">Distance</div><div class="scv">~0.8mi</div></div>
<div class="sci"><div class="scl">Time</div><div class="scv">45min</div></div>
</div>
<div class="cpnl">
<div class="cst w" id="cst">‚è≥ INITIALIZING COMPASS‚Ä¶</div>
<button class="actbtn" id="ibtn" onclick="reqC()">üß≠ ENABLE COMPASS</button>
<button class="actbtn" id="retrybtn" onclick="retryC()">üîÑ RETRY SENSOR</button>
<div class="cbox">
<div class="bzl" id="bzl">
<div class="cface">
<svg viewBox="0 0 200 200" id="tks"></svg>
<div class="clet n">N</div><div class="clet s">S</div><div class="clet e">E</div><div class="clet w">W</div>
<div class="csub" style="top:17%;left:81%">NE</div><div class="csub" style="top:17%;left:19%">NW</div>
<div class="csub" style="top:83%;left:81%">SE</div><div class="csub" style="top:83%;left:19%">SW</div>
<div class="csub" style="top:5%;left:50%;color:#aaa;font-size:.48rem">0¬∞</div>
<div class="csub" style="top:50%;left:95%;color:#aaa;font-size:.48rem">90¬∞</div>
<div class="csub" style="top:95%;left:50%;color:#aaa;font-size:.48rem">180¬∞</div>
<div class="csub" style="top:50%;left:5%;color:#aaa;font-size:.48rem">270¬∞</div>
</div>
</div>
<div class="ndl"><svg viewBox="0 0 200 200"><polygon points="100,16 107,90 100,80 93,90" fill="#DC143C" stroke="#8B0000" stroke-width=".5"/><polygon points="100,184 107,110 100,120 93,110" fill="#2C1810" stroke="#1a0f08" stroke-width=".5"/></svg></div>
<div class="tbm" id="tbm"><svg viewBox="0 0 200 200" id="tbsvg"><line x1="100" y1="100" x2="100" y2="20" stroke="#DAA520" stroke-width="2.5" stroke-dasharray="6 3" opacity=".75"/><circle cx="100" cy="20" r="5" fill="#DAA520" opacity=".85"/></svg></div>
<div class="ccap"></div>
</div>
<div class="hrd"><div class="hdg" id="hdg">---¬∞</div><div class="hdi" id="hdi">AWAITING SIGNAL</div></div>
<div class="tgt"><div class="tgl">Navigate to Waypoint</div><select class="tgs" id="tgs" onchange="uTgt()"><option value="">‚Äî Select Target Bearing ‚Äî</option></select><div class="tgi" id="tgi"></div></div>
<!-- Manual fallback slider -->
<div class="manual-sec" id="mansec">
<div class="manual-lab">MANUAL HEADING (no sensor ‚Äî drag to simulate)</div>
<input type="range" class="manual-range" id="manrng" min="0" max="359" value="0" oninput="manH(this.value)">
</div>
<div class="dbg" id="dbg"></div>
</div>
</div>

<div class="pnl" id="pm">
<div class="rsec">
<svg viewBox="0 0 200 200" style="width:145px;height:145px;filter:drop-shadow(2px 3px 5px rgba(0,0,0,.3))">
<defs><radialGradient id="rg" cx="50%" cy="50%"><stop offset="0%" stop-color="#FFF8E1"/><stop offset="100%" stop-color="#E8D5A8"/></radialGradient></defs>
<circle cx="100" cy="100" r="95" fill="url(#rg)" stroke="#2C1810" stroke-width="3"/>
<polygon points="100,15 106,85 100,75 94,85" fill="#DC143C"/><polygon points="100,185 106,115 100,125 94,115" fill="#2C1810"/>
<polygon points="15,100 85,94 75,100 85,106" fill="#2C1810"/><polygon points="185,100 115,94 125,100 115,106" fill="#2C1810"/>
<polygon points="40,40 88,88 80,92 92,80" fill="#DAA520" opacity=".5"/><polygon points="160,40 112,88 120,92 108,80" fill="#DAA520" opacity=".5"/>
<polygon points="40,160 88,112 80,108 92,120" fill="#DAA520" opacity=".5"/><polygon points="160,160 112,112 120,108 108,120" fill="#DAA520" opacity=".5"/>
<circle cx="100" cy="100" r="5" fill="#DAA520" stroke="#2C1810" stroke-width="1"/>
<text x="100" y="32" text-anchor="middle" fill="#DC143C" font-family="Bangers,cursive" font-weight="900" font-size="18">N</text>
<text x="100" y="178" text-anchor="middle" fill="#2C1810" font-family="Bangers,cursive" font-weight="700" font-size="15">S</text>
<text x="177" y="105" text-anchor="middle" fill="#2C1810" font-family="Bangers,cursive" font-weight="700" font-size="15">E</text>
<text x="23" y="105" text-anchor="middle" fill="#2C1810" font-family="Bangers,cursive" font-weight="700" font-size="15">W</text>
</svg>
</div>
<div class="legend">
<div class="lgi"><div class="lgs" style="background:rgba(26,107,138,.35)"></div>Water</div>
<div class="lgi"><div class="lgs" style="background:#2D5016"></div>Main Trail</div>
<div class="lgi"><div class="lgs" style="background:#C4A265;border-style:dashed"></div>Side Trail</div>
<div class="lgi"><div class="lgs" style="background:#E8751A"></div>Waypoint</div>
<div class="lgi"><div class="lgs" style="background:#28A745"></div>Found!</div>
<div class="lgi"><div class="lgs" style="background:#DC143C"></div>Start</div>
</div>
<div class="mwrap"><div class="map">
<div class="mgr"></div>
<div class="wtr" style="left:22%;top:25%;width:18%;height:22%"></div>
<div class="wtr" style="left:55%;top:35%;width:14%;height:18%"></div>
<div class="wtr" style="left:35%;top:55%;width:20%;height:15%;border-radius:40% 60% 50% 50%"></div>
<div class="wtr" style="left:15%;top:60%;width:12%;height:14%"></div>
<div class="mlb" style="left:24%;top:20%;transform:rotate(-5deg)">Basin 1</div>
<div class="mlb" style="left:57%;top:30%">Basin 2</div>
<div class="mlb" style="left:38%;top:52%">Basin 3</div>
<div class="mlb" style="left:16%;top:57%">Basin 4</div>
<svg class="trl" viewBox="0 0 400 300">
<path d="M40,280 C60,250 80,200 100,170 S140,120 160,100 S200,70 240,80 S300,100 340,120 S370,160 360,200 S320,250 280,270 S220,290 180,280 S120,260 80,270Z" fill="none" stroke="#2D5016" stroke-width="3" opacity=".45"/>
<path d="M100,170 L140,190 L180,160 L220,180" fill="none" stroke="#C4A265" stroke-width="2.5" stroke-dasharray="8 4" opacity=".6"/>
<path d="M240,80 L260,120 L300,140" fill="none" stroke="#C4A265" stroke-width="2.5" stroke-dasharray="8 4" opacity=".6"/>
<path d="M160,100 L180,60 L220,50" fill="none" stroke="#C4A265" stroke-width="2.5" stroke-dasharray="8 4" opacity=".6"/>
<path d="M280,270 L320,220 L350,180" fill="none" stroke="#C4A265" stroke-width="2.5" stroke-dasharray="8 4" opacity=".6"/>
</svg>
<div class="scbar"><div class="scln"></div><div class="sctx">0 ‚Äî‚Äî 200ft</div></div>
<svg viewBox="0 0 50 50" style="position:absolute;top:6px;right:6px;width:36px;height:36px;z-index:5"><circle cx="25" cy="25" r="22" fill="rgba(245,230,200,.9)" stroke="#2C1810" stroke-width="1.5"/><polygon points="25,6 27,21 25,19 23,21" fill="#DC143C"/><polygon points="25,44 27,29 25,31 23,29" fill="#2C1810"/><text x="25" y="14" text-anchor="middle" fill="#DC143C" font-weight="900" font-size="7">N</text></svg>
<div class="mk" id="m0" style="left:10%;top:88%" onclick="tog(0)"><div class="mp" style="background:#DC143C"><span class="mi">‚≠ê</span></div><span class="mn">S</span></div>
<div class="mk" id="m1" style="left:18%;top:68%" onclick="tog(1)"><div class="mp" style="background:#E8751A"><span class="mi">üåµ</span></div><span class="mn">1</span></div>
<div class="mk" id="m2" style="left:30%;top:42%" onclick="tog(2)"><div class="mp" style="background:#E8751A"><span class="mi">ü¶é</span></div><span class="mn">2</span></div>
<div class="mk" id="m3" style="left:22%;top:22%" onclick="tog(3)"><div class="mp" style="background:#E8751A"><span class="mi">üê¶</span></div><span class="mn">3</span></div>
<div class="mk" id="m4" style="left:42%;top:15%" onclick="tog(4)"><div class="mp" style="background:#E8751A"><span class="mi">ü™®</span></div><span class="mn">4</span></div>
<div class="mk" id="m5" style="left:58%;top:28%" onclick="tog(5)"><div class="mp" style="background:#E8751A"><span class="mi">üåä</span></div><span class="mn">5</span></div>
<div class="mk" id="m6" style="left:72%;top:42%" onclick="tog(6)"><div class="mp" style="background:#E8751A"><span class="mi">ü¶Ö</span></div><span class="mn">6</span></div>
<div class="mk" id="m7" style="left:85%;top:55%" onclick="tog(7)"><div class="mp" style="background:#E8751A"><span class="mi">üèúÔ∏è</span></div><span class="mn">7</span></div>
<div class="mk" id="m8" style="left:75%;top:72%" onclick="tog(8)"><div class="mp" style="background:#E8751A"><span class="mi">üåø</span></div><span class="mn">8</span></div>
<div class="mk" id="m9" style="left:50%;top:82%" onclick="tog(9)"><div class="mp" style="background:#E8751A"><span class="mi">üèÅ</span></div><span class="mn">9</span></div>
</div></div>
</div>

<div class="pnl" id="pw">
<div class="wsec"><div class="stit">MISSION WAYPOINTS</div><div class="wgr" id="wgr"></div></div>
<div class="rrow"><button class="rbtn" onclick="rstAll()">‚Ü∫ RESET ALL WAYPOINTS</button></div>
</div>

<div class="pnl" id="pl">
<div class="lsec"><div class="lcard">
<div class="ltit">HOW TO USE YOUR COMPASS</div>
<div class="ls"><div class="lnm">1</div><div class="ltx"><strong>Hold it flat</strong> at waist height. Needle floats ‚Äî don't tilt!</div></div>
<div class="ls"><div class="lnm">2</div><div class="ltx"><strong>Let the needle settle.</strong> RED end always points NORTH.</div></div>
<div class="ls"><div class="lnm">3</div><div class="ltx"><strong>Rotate the bezel</strong> until "N" lines up with the RED needle.</div></div>
<div class="ls"><div class="lnm">4</div><div class="ltx"><strong>Read your bearing:</strong> Direction-of-travel arrow meets bezel = heading (0¬∞=N, 90¬∞=E, 180¬∞=S, 270¬∞=W).</div></div>
<div class="ls"><div class="lnm">5</div><div class="ltx"><strong>Navigate to waypoint:</strong> Set target on bezel, rotate BODY until red needle sits in orienting arrow ("red in the shed"). Walk!</div></div>
<div class="ls"><div class="lnm">6</div><div class="ltx"><strong>Pace counting:</strong> Each pair of steps ‚âà 5 feet. Count paces between waypoints.</div></div>
</div></div>
<div class="tsec"><div class="stit" style="color:var(--ink);text-shadow:none">TOPOGRAPHIC SYMBOLS</div>
<div class="tgr">
<div class="tit2"><div class="tic">„Ä∞Ô∏è</div><div class="tnm">Contour Line</div><div class="tds">Closer = steeper</div></div>
<div class="tit2"><div class="tic">üíß</div><div class="tnm">Water Feature</div><div class="tds">Pond, basin, wetland</div></div>
<div class="tit2"><div class="tic">üå≥</div><div class="tnm">Vegetation</div><div class="tds">Trees, bushes, cover</div></div>
<div class="tit2"><div class="tic">- - -</div><div class="tnm">Trail (Unpaved)</div><div class="tds">Dirt/gravel path</div></div>
<div class="tit2"><div class="tic">‚îÅ‚îÅ</div><div class="tnm">Trail (Paved)</div><div class="tds">Concrete / asphalt</div></div>
<div class="tit2"><div class="tic">‚ñ≤</div><div class="tnm">Benchmark</div><div class="tds">Known elevation pt</div></div>
</div></div>
</div>
<div class="ftr">SCOUT COMPASS ADVENTURE | Riparian Preserve at Water Ranch, Gilbert, AZ<br>45-Min Course ¬∑ Stay on trails ¬∑ Bring water ¬∑ Buddy system ¬∑ Leader approval before crossing water</div>
<script>
var W=[
{id:0,n:"S",nm:"RALLY POINT",sub:"Library Parking Lot",lat:"33.3644¬∞ N",lon:"111.7347¬∞ W",br:"‚Äî START ‚Äî",bd:null,dist:"START",clue:"Gather at the main parking lot by the library. Face NORTH. Your adventure begins!",task:"Orient your compass. Find North. Identify E, S, W. Buddy up!"},
{id:1,n:"1",nm:"DESERT SENTINEL",sub:"Saguaro Junction",lat:"33.3640¬∞ N",lon:"111.7352¬∞ W",br:"325¬∞ (NW)",bd:325,dist:"~100 ft",clue:"Aim compass to 325¬∞ NW from Rally Point. Find the tallest cactus near the first trail split.",task:"Quick sketch the saguaro. Count its arms. Go!"},
{id:2,n:"2",nm:"LIZARD LOOKOUT",sub:"Basin Overlook",lat:"33.3647¬∞ N",lon:"111.7344¬∞ W",br:"30¬∞ (NNE)",bd:30,dist:"~150 ft",clue:"Head 30¬∞ NNE from WP1. Follow trail until first water basin on your LEFT.",task:"Record GPS coords from your card. Scan for lizards!"},
{id:3,n:"3",nm:"BIRD BLIND",sub:"North Observation Point",lat:"33.3652¬∞ N",lon:"111.7348¬∞ W",br:"350¬∞ (N)",bd:350,dist:"~120 ft",clue:"Bearing 350¬∞ almost due North. Covered observation area near water's edge.",task:"60-second silent count ‚Äî how many bird species?"},
{id:4,n:"4",nm:"BOULDER RIDGE",sub:"Trail Intersection",lat:"33.3655¬∞ N",lon:"111.7340¬∞ W",br:"65¬∞ (ENE)",bd:65,dist:"~180 ft",clue:"Take bearing 65¬∞ ENE past Basin 1. Large rock formation where trails cross.",task:"Shoot a bearing to the NEXT waypoint. Record it."},
{id:5,n:"5",nm:"WATER'S EDGE",sub:"Basin 2 Dock",lat:"33.3650¬∞ N",lon:"111.7335¬∞ W",br:"130¬∞ (SE)",bd:130,dist:"~150 ft",clue:"Head 130¬∞ SE. Find the viewing platform or dock area.",task:"Measure bearing BACK to WP4. Should be reciprocal (310¬∞). Verify!"},
{id:6,n:"6",nm:"HAWK'S PERCH",sub:"East Ridge Trail",lat:"33.3645¬∞ N",lon:"111.7328¬∞ W",br:"110¬∞ (ESE)",bd:110,dist:"~150 ft",clue:"Compass bearing 110¬∞ ESE. Take east side trail.",task:"Take bearing to 2 visible landmarks. Record on datasheet."},
{id:7,n:"7",nm:"DESERT WASH",sub:"Southeast Boundary",lat:"33.3638¬∞ N",lon:"111.7322¬∞ W",br:"155¬∞ (SSE)",bd:155,dist:"~180 ft",clue:"Follow 155¬∞ SSE along preserve boundary. Find the dry wash.",task:"Quick sketch: how does water shape this desert terrain?"},
{id:8,n:"8",nm:"MESQUITE CAMP",sub:"South Trail Bend",lat:"33.3635¬∞ N",lon:"111.7332¬∞ W",br:"235¬∞ (SW)",bd:235,dist:"~150 ft",clue:"Turn to 235¬∞ SW. Mesquite tree cluster near south trail bend.",task:"Pace count to nearest water basin edge. Record distance."},
{id:9,n:"9",nm:"FINISH LINE",sub:"South Ramada",lat:"33.3637¬∞ N",lon:"111.7343¬∞ W",br:"280¬∞ (WNW)",bd:280,dist:"~160 ft",clue:"Final leg! 280¬∞ WNW to covered ramada/picnic area.",task:"MISSION COMPLETE! Final bearing back to Rally Point. Regroup!"}
];
var F=[0,0,0,0,0,0,0,0,0,0],SK='scout_compass_v4';
function ld(){try{var s=localStorage.getItem(SK);if(s)F=JSON.parse(s)}catch(e){}}
function sv(){try{localStorage.setItem(SK,JSON.stringify(F))}catch(e){}}
ld();

var TN=['c','m','w','l'],TI=['pc','pm','pw','pl'];
function tab(t){for(var i=0;i<4;i++){document.getElementById('t'+i).classList[TN[i]===t?'add':'remove']('on');document.getElementById(TI[i]).classList[TN[i]===t?'add':'remove']('on')}}
function ufc(){var c=0;for(var i=0;i<F.length;i++)if(F[i])c++;document.getElementById('fc').textContent=c}
function tog(id){F[id]=F[id]?0:1;var m=document.getElementById('m'+id);if(m){if(F[id])m.classList.add('fd');else m.classList.remove('fd')}sv();ufc();rC()}
function rstAll(){if(!confirm('Reset ALL waypoints?'))return;for(var i=0;i<F.length;i++){F[i]=0;var m=document.getElementById('m'+i);if(m)m.classList.remove('fd')}sv();ufc();rC()}
function rC(){var g=document.getElementById('wgr'),h='';for(var i=0;i<W.length;i++){var w=W[i],f=F[w.id];h+='<div class="wc'+(f?' fd':'')+'">'+'<div class="fb">FOUND!</div>'+'<div class="wh"><div class="wn">'+w.n+'</div><div><div class="wnm">'+w.nm+'</div><div class="wsu">'+w.sub+'</div></div></div>'+'<div class="wcr">'+w.lat+' | '+w.lon+'</div>'+'<div class="wd"><div><span class="wdl">Bearing</span><br>'+w.br+'</div><div><span class="wdl">Distance</span><br>'+w.dist+'</div></div>'+'<div class="wcl"><strong style="font-style:normal">üîç CLUE: </strong>'+w.clue+'</div>'+'<div class="wt"><strong style="color:#2D5016">SCOUT TASK:</strong> '+w.task+'</div>'+'<button class="wb" onclick="tog('+w.id+')">'+(f?'‚úì FOUND!':'MARK AS FOUND')+'</button></div>';}g.innerHTML=h}
function rM(){for(var i=0;i<F.length;i++){var m=document.getElementById('m'+i);if(m&&F[i])m.classList.add('fd')}}
function bT(){var svg=document.getElementById('tks'),cx=100,cy=100;for(var d=0;d<360;d+=5){var mj=d%30===0,r=d*Math.PI/180,oR=96,iR=mj?83:88;var l=document.createElementNS('http://www.w3.org/2000/svg','line');l.setAttribute('x1',cx+oR*Math.sin(r));l.setAttribute('y1',cy-oR*Math.cos(r));l.setAttribute('x2',cx+iR*Math.sin(r));l.setAttribute('y2',cy-iR*Math.cos(r));l.setAttribute('stroke','#2C1810');l.setAttribute('stroke-width',mj?'1.8':'.7');l.setAttribute('opacity',mj?'.6':'.25');svg.appendChild(l)}}
function bS(){var s=document.getElementById('tgs');for(var i=0;i<W.length;i++){var w=W[i];if(w.bd!==null){var o=document.createElement('option');o.value=w.bd;o.textContent='WP'+w.n+': '+w.nm+' ('+w.br+')';s.appendChild(o)}}}

/* ============================================================
   LIVE COMPASS ENGINE
   - Reads DeviceOrientationEvent (magnetometer)
   - iOS: webkitCompassHeading (requires permission tap)
   - Android: alpha from deviceorientationabsolute or deviceorientation
   - Fallback: manual slider for desktop/no-sensor
   ============================================================ */
var hd=null,tb=null,compOn=false,sm=null,LP=0.22,evtCount=0,lastRaw=null;
var dbgEl;

function c16(d){return['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'][Math.round(d/22.5)%16]}

function dbg(msg){if(dbgEl)dbgEl.textContent=msg}

function setH(val){
  hd=Math.round(val);
  document.getElementById('bzl').style.transform='rotate('+(-hd)+'deg)';
  document.getElementById('hdg').textContent=hd+'¬∞';
  document.getElementById('hdi').textContent=c16(hd);
  uT();
}

function onO(e){
  evtCount++;
  var h=null;
  // iOS provides direct compass heading
  if(typeof e.webkitCompassHeading==='number'&&!isNaN(e.webkitCompassHeading)){
    h=e.webkitCompassHeading;
    lastRaw='iOS:'+Math.round(h);
  }
  // Android absolute orientation
  else if(e.alpha!==null&&!isNaN(e.alpha)){
    // If absolute is true, alpha=0 means north
    if(e.absolute===true){
      h=(360-e.alpha)%360;
      lastRaw='abs:a='+Math.round(e.alpha);
    }else{
      // Relative ‚Äî still usable as approximate heading
      h=(360-e.alpha)%360;
      lastRaw='rel:a='+Math.round(e.alpha);
    }
  }

  dbg('events:'+evtCount+' raw:'+lastRaw+' abs:'+e.absolute+' a:'+Math.round(e.alpha||0)+' b:'+Math.round(e.beta||0)+' g:'+Math.round(e.gamma||0));

  if(h===null||isNaN(h))return;
  h=((h%360)+360)%360;

  // Low-pass filter
  if(sm===null)sm=h;
  else{var df=h-sm;if(df>180)df-=360;if(df<-180)df+=360;sm=((sm+df*LP)%360+360)%360}

  if(!compOn){
    compOn=true;
    var s=document.getElementById('cst');s.className='cst ok';
    s.textContent='‚úÖ COMPASS ACTIVE ‚Äî LIVE HEADING';
    document.getElementById('mansec').style.display='none';
    document.getElementById('retrybtn').style.display='none';
  }
  setH(sm);
}

/* Manual heading for desktop/no-sensor fallback */
function manH(val){
  sm=parseFloat(val);
  setH(sm);
  if(!compOn){
    document.getElementById('cst').className='cst w';
    document.getElementById('cst').textContent='üéõÔ∏è MANUAL MODE ‚Äî DRAG SLIDER';
  }
}

function uTgt(){
  var v=document.getElementById('tgs').value,el=document.getElementById('tbm');
  if(!v){tb=null;el.style.opacity='0';document.getElementById('tgi').innerHTML='';return}
  tb=parseInt(v);el.style.opacity='1';uT();
}
function uT(){
  if(tb===null)return;
  if(hd!==null){
    var sa=tb-hd;
    document.getElementById('tbsvg').style.transform='rotate('+sa+'deg)';
    var diff=tb-hd;if(diff>180)diff-=360;if(diff<-180)diff+=360;
    var ad=Math.abs(diff),el=document.getElementById('tgi');
    if(ad<=5)el.innerHTML='<span class="ok">üéØ ON TARGET ‚Äî WALK FORWARD!</span>';
    else if(diff>0)el.innerHTML='‚Üª Turn RIGHT '+Math.round(ad)+'¬∞';
    else el.innerHTML='‚Ü∫ Turn LEFT '+Math.round(ad)+'¬∞';
  }else document.getElementById('tgi').innerHTML='Point compass to navigate';
}

/* === COMPASS INIT === */
function initC(){
  dbgEl=document.getElementById('dbg');
  if(typeof DeviceOrientationEvent==='undefined'){
    showFallback('DeviceOrientationEvent not available');return;
  }
  // iOS 13+ needs user-gesture permission
  if(typeof DeviceOrientationEvent.requestPermission==='function'){
    document.getElementById('ibtn').style.display='block';
    document.getElementById('cst').className='cst w';
    document.getElementById('cst').textContent='üì± TAP "ENABLE COMPASS" TO START';
    dbg('iOS detected ‚Äî awaiting permission tap');
  }else{
    // Android / desktop
    dbg('Non-iOS: attaching listeners...');
    document.getElementById('cst').textContent='‚è≥ LISTENING FOR SENSOR‚Ä¶';
    window.addEventListener('deviceorientationabsolute',onO,true);
    window.addEventListener('deviceorientation',onO,true);
    // Timeout: if no usable data after 4s, show fallback
    setTimeout(function(){
      if(!compOn){
        if(evtCount>0){
          // Events fired but no usable heading ‚Äî Android issue
          showFallback('Sensor events received ('+evtCount+') but no heading data. Try: Settings > Location > ON for this site, or try Samsung Internet browser.');
        }else{
          showFallback('No sensor detected ‚Äî this device may not have a magnetometer, or you are on desktop.');
        }
      }
    },4000);
  }
}

function showFallback(reason){
  var s=document.getElementById('cst');
  s.className='cst no';
  s.textContent='‚ö†Ô∏è NO LIVE COMPASS';
  document.getElementById('mansec').style.display='block';
  document.getElementById('retrybtn').style.display='block';
  dbg(reason);
}

function reqC(){
  DeviceOrientationEvent.requestPermission().then(function(r){
    if(r==='granted'){
      window.addEventListener('deviceorientation',onO,true);
      document.getElementById('ibtn').style.display='none';
      document.getElementById('cst').className='cst w';
      document.getElementById('cst').textContent='‚è≥ ACQUIRING HEADING‚Ä¶';
      dbg('Permission granted, listening...');
      setTimeout(function(){if(!compOn)showFallback('Permission granted but no heading data received')},4000);
    }else{
      document.getElementById('cst').className='cst dn';
      document.getElementById('cst').textContent='üö´ COMPASS DENIED ‚Äî CHECK SETTINGS';
      document.getElementById('mansec').style.display='block';
      dbg('Permission denied by user');
    }
  }).catch(function(err){
    document.getElementById('cst').className='cst dn';
    document.getElementById('cst').textContent='‚ùå PERMISSION ERROR';
    document.getElementById('mansec').style.display='block';
    dbg('Error: '+err);
  });
}

function retryC(){
  compOn=false;evtCount=0;sm=null;hd=null;lastRaw=null;
  document.getElementById('mansec').style.display='none';
  document.getElementById('retrybtn').style.display='none';
  document.getElementById('hdg').textContent='---¬∞';
  document.getElementById('hdi').textContent='AWAITING SIGNAL';
  initC();
}

/* BOOT */
rM();ufc();rC();bT();bS();initC();
</script>
</body>
</html>
